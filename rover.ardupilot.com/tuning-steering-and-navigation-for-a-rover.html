<!-- 
START METADATA - Only title should be translated 
slug: tuning-steering-and-navigation-for-a-rover 
title: Tuning steering and navigation for a Rover 
id: 1894 
menu_order: 70 
post_parent_id: 0 
post_parent_stub:  
post_parent_title:  
END METADATA 
-->
When setting up a Rover there are 6 key parameters you need to get right. This guide provides a set of steps to get those parameters right, so that your rover will accurately navigate in AUTO mode.

<h1>The key parameters</h1>
<ul>
	<li><code>STEER2SRV_P</code>: This tells the rover code what the turning circle (as a diameter in meters) is for your rover. It is critical that you get this parameter right, as it tells the code what steering angle to choose to achieve a desired turn rate.</li>
	<li><code>TURN_MAX_G</code>: This tells the rover the maximum G force (in multiples of one gravity) that your rover can handle while remaining stable. If you set this too high then your rover may flip over in turns, or skid. If you set it too low then your rover will not be able to turn sharply enough.</li>
	<li><code>NAVL1_PERIOD</code>: This controls the aggressiveness of the navigation algorithm. A smaller number means more aggressive turning in AUTO mode, a large number means larger, smoother turns.</li>
	<li><code>SPEED_TURN_GAIN</code>: This controls how much the rover should slow down while turning, as a percentage of current target speed. To not slow down at all in turns set this to 100. When doing initial tuning it is recommended you use 100, and lower this later to improve handling of tight courses.</li>
	<li><code>CRUISE_SPEED</code>: This controls the target speed in meters/second in AUTO.</li>
	<li><code>CRUISE_THROTTLE</code>: This sets the initial guess at what throttle is needed to achieve CRUISE_SPEED when driving straight ahead. This needs to be right for the rover to achieve good speed control.</li>
</ul>



<h1>Step 1: Setting initial parameters</h1>
To start the tuning process set the following values:
<ul>
	<li>STEER2SRV_P = 2</li>
	<li>TURN_MAX_G = 1</li>
	<li>NAVL1_PERIOD = 6</li>
	<li>SPEED_TURN_GAIN = 100</li>
	<li>CRUISE_SPEED = 2</li>
	<li>CRUISE_THROTTLE = 20</li>
</ul>
These are conservative values that should give you slow, gentle behaviour for most rovers.



<h1>Step 2: Setting CRUISE_THROTTLE</h1>
We need to get <code>CRUISE_THROTTLE</code> right so we know what throttle level will give us a speed of 2 meters/second.
<ul>
	<li>Switch to MANUAL mode</li>
	<li>Slowly advance the throttle until the ground station shows a speed of 2 meters/second</li>
	<li>note the throttle percentage shown in the HUD</li>
	<li>set CRUISE_THROTTLE to the percentage needed for straight driving at 2 meters/second</li>
</ul>



<h1>Step 3: Setting the STEER2SRV_P</h1>
To set your STEER2SRV_P parameter you need to measure the diameter of the turning circle of your rover.

Put your rover into MANUAL mode, and put the steering hard over to one side. Then very slowly drive your rover in a circle. Use a tape measure to measure the diameter of that circle and set STEER2SRV_P to that value in meters.



<h1>Step 4: tuning TURN_MAX_G</h1>
The <code>TURN_MAX_G</code> parameter can now be tuned so that your rover can drive more aggressively, without turning over.
<ul>
	<li>put into STEERING mode</li>
	<li>turn at maximum turn rate and maximum throttle</li>
	<li>adjust TURN_MAX_G to highest level that rover remains stable, doesn't start to roll over and doesn't skid</li>
</ul>



<h1>Step 5: tuning NAVL1_PERIOD</h1>
Now you can finally start tuning your steering in AUTO mode. To tune in AUTO you will need to create a mission for your rover to navigate. A simple rectangular mission is the best to start with.
<ul>
	<li>create a rectangular course for the rover</li>
	<li>run the course in AUTO mode</li>
	<li>if the rover weaves along the straights, then raise NAVL1_PERIOD in increments of 0.5</li>
	<li>if the rover doesn't turn sharply enough then lower NAVL1_PERIOD in increments of 0.5</li>
	<li>if the rover is turning too late in corners then raise WP_RADIUS in increments of 1.0</li>
</ul>
You may also find that you may need to raise NAVL1_DAMPING slightly to improve navigation in tight courses.



<h1>Final Setup</h1>
Now that you have the basic parameters tuned you may find you can go back and raise CRUISE_SPEED for faster driving. If you do, then make sure you adjust CRUISE_THROTTLE to suit.

You may also like to lower SPEED_TURN_GAIN to ask the rover to slow down a bit when turning. That would allow for higher speeds when driving straight ahead.

There are a number of other parameters that can be used to fine tune your steering once you haveÂ completed the basic ones above. Please see the <a href="/wiki/apmrover2-parameters/">full parameter list</a> for details.

Some parameters to pay particular attention to are STEER2SRV_TCONST, STEER2SRV_I, STEER2SRV_D and STEER2SRV_IMAX.
<h1>Fixing problems with weaving</h1>
A common issue with rovers is that the steering 'weaves', turning from side to side rather than turning smoothly. There can be several possible reasons for this happening.

The first thing you need to work out is if the problem is confined to low speed driving or also affects higher speed driving. If the problem only happens at very low speed (such as when first entering auto on a mission) then the most likely problem is that STEER2SRV_MINSPD is too low. The default is 1.0 m/s, which is quite low, and if your GPS heading isn't very reliable at low speed then you may need to raise that number. Try 2.0 and see if that helps with low speed weaving.

If the problem also happens at higher speeds then it is likely to either be the L1 navigation tuning or the steering controller tuning. To fix it you will need to understand how these parameters work.

The NAVL1_PERIOD controls how rapidly the L1 navigation controller changes the demanded steering direction. Making this number larger will reduce weaving in AUTO, but it will also mean that you can't steer as accurately around tight corners. Try raising NAVL1_PERIOD in steps of 0.5 until the weaving stops. For most rovers a value between 6.0 and 8.0 is good, but some rovers may need higher values.

If raising the NAVL1_PERIOD fixes the weaving but leaves you unable to handle sharp turns in missions then you will instead need to tune the steering controller.

In the steering controller there are 3 key parameters that will control weaving:
<ul>
	<li>A smaller STEER2SRV_P will reduce weaving, try reducing it by 0.1 at a time</li>
	<li>A larger STEER2SRV_D will "damp" the weaving, but if you make it too large then you will get high speed oscillation. For example you may find that a value of 0.1 reduces the damping, but a value of 0.2 could cause a high speed oscillation in the steering servo. If you get fast oscillation then reduce the STEER2SRV_D value by 50%.</li>
	<li>A larger STEER2SRV_TCONST will slow down the steering controller, which will reduce weaving. Try raising it in steps of 0.1.</li>
</ul>
With the current controller system you do need to experiment a bit with these values to get the behaviour you want. We hope to introduce an automatic tuning system in future, but for now manual tuning is needed.